# å®‰å…¨ç‰¹æ€§å®ç°

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**   
- [auth.py](file://src/auth.py)
- [test_auth.py](file://test/test_auth.py)
</cite>

## ç›®å½•
1. [å®‰å…¨æœºåˆ¶æ¦‚è¿°](#å®‰å…¨æœºåˆ¶æ¦‚è¿°)
2. [å¯†ç å“ˆå¸Œä¸å¼ºåº¦éªŒè¯](#å¯†ç å“ˆå¸Œä¸å¼ºåº¦éªŒè¯)
3. [è´¦æˆ·é”å®šç­–ç•¥](#è´¦æˆ·é”å®šç­–ç•¥)
4. [é”™è¯¯ä¿¡æ¯æ¨¡ç³ŠåŒ–å¤„ç†](#é”™è¯¯ä¿¡æ¯æ¨¡ç³ŠåŒ–å¤„ç†)
5. [æµ‹è¯•éªŒè¯æœºåˆ¶](#æµ‹è¯•éªŒè¯æœºåˆ¶)
6. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
7. [æ‰©å±•æ–¹æ¡ˆå»ºè®®](#æ‰©å±•æ–¹æ¡ˆå»ºè®®)

## å®‰å…¨æœºåˆ¶æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†å…¨é¢çš„å®‰å…¨ç‰¹æ€§ï¼ŒåŒ…æ‹¬åŸºäºPBKDF2-HMAC-SHA256çš„å¯†ç å“ˆå¸Œã€è´¦æˆ·é”å®šç­–ç•¥ã€å¯†ç å¼ºåº¦éªŒè¯å’Œä¼šè¯ç®¡ç†ç­‰æœºåˆ¶ã€‚è¿™äº›å®‰å…¨æªæ–½å…±åŒä¿éšœäº†ç”¨æˆ·è®¤è¯ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚

**Section sources**
- [auth.py](file://src/auth.py#L38-L80)

## å¯†ç å“ˆå¸Œä¸å¼ºåº¦éªŒè¯

### å¯†ç å“ˆå¸Œå®ç°
ç³»ç»Ÿé‡‡ç”¨PBKDF2-HMAC-SHA256ç®—æ³•å¯¹ç”¨æˆ·å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œé€šè¿‡100,000æ¬¡è¿­ä»£å¢å¼ºå®‰å…¨æ€§ï¼Œæœ‰æ•ˆæŠµå¾¡å½©è™¹è¡¨æ”»å‡»ã€‚

```mermaid
sequenceDiagram
participant ç”¨æˆ·
participant auth.py
participant æ•°æ®åº“
ç”¨æˆ·->>auth.py : æäº¤å¯†ç 
auth.py->>auth.py : ç”Ÿæˆéšæœºç›å€¼
auth.py->>auth.py : æ‰§è¡ŒPBKDF2-HMAC-SHA256å“ˆå¸Œ
auth.py->>æ•°æ®åº“ : å­˜å‚¨å“ˆå¸Œå€¼å’Œç›å€¼
```

**Diagram sources**
- [auth.py](file://src/auth.py#L100-L102)

### å¯†ç å¼ºåº¦éªŒè¯è§„åˆ™
ç³»ç»Ÿå®æ–½ä¸¥æ ¼çš„å¯†ç å¼ºåº¦ç­–ç•¥ï¼Œç¡®ä¿ç”¨æˆ·åˆ›å»ºå®‰å…¨çš„å¯†ç ï¼š

| éªŒè¯è§„åˆ™ | å®ç°é€»è¾‘ | é”™è¯¯æç¤º |
|---------|--------|--------|
| æœ€å°é•¿åº¦ | æ£€æŸ¥å¯†ç é•¿åº¦æ˜¯å¦å°äºMIN_PASSWORD_LENGTH | "å¯†ç é•¿åº¦è‡³å°‘ä¸º6ä½" |
| åŒ…å«å­—æ¯ | ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥æ˜¯å¦å­˜åœ¨å­—æ¯å­—ç¬¦ | "å¯†ç å¿…é¡»åŒ…å«å­—æ¯" |
| åŒ…å«æ•°å­— | ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ•°å­—å­—ç¬¦ | "å¯†ç å¿…é¡»åŒ…å«æ•°å­—" |

```mermaid
flowchart TD
Start([å¼€å§‹å¯†ç éªŒè¯]) --> CheckLength["æ£€æŸ¥å¯†ç é•¿åº¦ â‰¥ 6"]
CheckLength --> LengthValid{"é•¿åº¦æœ‰æ•ˆ?"}
LengthValid --> |å¦| ReturnLengthError["è¿”å›é•¿åº¦é”™è¯¯"]
LengthValid --> |æ˜¯| CheckLetter["æ£€æŸ¥åŒ…å«å­—æ¯"]
CheckLetter --> LetterValid{"åŒ…å«å­—æ¯?"}
LetterValid --> |å¦| ReturnLetterError["è¿”å›å­—æ¯é”™è¯¯"]
LetterValid --> |æ˜¯| CheckNumber["æ£€æŸ¥åŒ…å«æ•°å­—"]
CheckNumber --> NumberValid{"åŒ…å«æ•°å­—?"}
NumberValid --> |å¦| ReturnNumberError["è¿”å›æ•°å­—é”™è¯¯"]
NumberValid --> |æ˜¯| ReturnSuccess["è¿”å›éªŒè¯æˆåŠŸ"]
```

**Diagram sources**
- [auth.py](file://src/auth.py#L114-L125)

**Section sources**
- [auth.py](file://src/auth.py#L114-L125)

## è´¦æˆ·é”å®šç­–ç•¥

### é”å®šæœºåˆ¶å®ç°
ç³»ç»Ÿå®ç°äº†åŸºäºå¤±è´¥å°è¯•è®¡æ•°çš„è´¦æˆ·é”å®šæœºåˆ¶ï¼Œæœ‰æ•ˆé˜²æ­¢æš´åŠ›ç ´è§£æ”»å‡»ã€‚

```mermaid
classDiagram
class AccountLocking {
+int MAX_LOGIN_ATTEMPTS = 5
+int failed_login_attempts
+str locked_until
+is_user_locked(username) bool
+increment_failed_login(username) void
+clear_user_lock(username) void
}
```

**Diagram sources**
- [auth.py](file://src/auth.py#L44-L63)

### ç™»å½•å¤±è´¥å¤„ç†æµç¨‹
ä»å¤šæ¬¡ç™»å½•å¤±è´¥åˆ°è´¦æˆ·é”å®šçš„å®Œæ•´æµç¨‹å¦‚ä¸‹ï¼š

```mermaid
flowchart TD
A[ç”¨æˆ·å°è¯•ç™»å½•] --> B{éªŒè¯å‡­æ®}
B --> |å¤±è´¥| C[å¢åŠ å¤±è´¥è®¡æ•°]
C --> D{å¤±è´¥æ¬¡æ•° â‰¥ 5?}
D --> |å¦| E[è¿”å›ç™»å½•å¤±è´¥]
D --> |æ˜¯| F[è®¾ç½®é”å®šæ—¶é—´+1å°æ—¶]
F --> G[è´¦æˆ·è¢«é”å®š]
B --> |æˆåŠŸ| H[æ¸…é™¤å¤±è´¥è®¡æ•°]
H --> I[ç™»å½•æˆåŠŸ]
```

**Diagram sources**
- [auth.py](file://src/auth.py#L155-L205)

### é”å®šçŠ¶æ€æ£€æŸ¥
ç³»ç»Ÿåœ¨æ¯æ¬¡ç™»å½•å°è¯•å‰æ£€æŸ¥ç”¨æˆ·é”å®šçŠ¶æ€ï¼Œç¡®ä¿å®‰å…¨ç­–ç•¥çš„æœ‰æ•ˆæ‰§è¡Œã€‚

```mermaid
sequenceDiagram
participant ç”¨æˆ·
participant is_user_locked
participant æ•°æ®åº“
ç”¨æˆ·->>is_user_locked : è¯·æ±‚ç™»å½•
is_user_locked->>æ•°æ®åº“ : æŸ¥è¯¢failed_login_attemptså’Œlocked_until
æ•°æ®åº“-->>is_user_locked : è¿”å›ç»“æœ
is_user_locked->>is_user_locked : æ£€æŸ¥locked_untilæ—¶é—´
is_user_locked->>is_user_locked : å¦‚æœå·²è¿‡æœŸåˆ™æ¸…é™¤é”å®š
is_user_locked-->>ç”¨æˆ· : è¿”å›é”å®šçŠ¶æ€
```

**Diagram sources**
- [auth.py](file://src/auth.py#L135-L159)

**Section sources**
- [auth.py](file://src/auth.py#L135-L159)

## é”™è¯¯ä¿¡æ¯æ¨¡ç³ŠåŒ–å¤„ç†

### æ•æ„Ÿæ“ä½œé”™è¯¯å¤„ç†
ç³»ç»Ÿå¯¹æ•æ„Ÿæ“ä½œçš„é”™è¯¯ä¿¡æ¯è¿›è¡Œæ¨¡ç³ŠåŒ–å¤„ç†ï¼Œé˜²æ­¢ä¿¡æ¯æ³„éœ²ï¼š

- ç™»å½•å¤±è´¥æ—¶ç»Ÿä¸€æ˜¾ç¤º"âŒ ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"ï¼Œä¸åŒºåˆ†å…·ä½“åŸå› 
- è´¦æˆ·é”å®šæ—¶æ˜¾ç¤º"ğŸ”’ è´¦æˆ·å·²è¢«é”å®šï¼Œè¯·åœ¨Xåˆ†é’Ÿåé‡è¯•"ï¼Œä¸é€éœ²å…·ä½“é”å®šåŸå› 
- æ³¨å†Œæ—¶ç”¨æˆ·åæˆ–é‚®ç®±å·²å­˜åœ¨ï¼Œåˆ†åˆ«æç¤º"ç”¨æˆ·åå·²å­˜åœ¨"æˆ–"é‚®ç®±å·²è¢«æ³¨å†Œ"ï¼Œé¿å…æš´éœ²å…¶ä»–ç”¨æˆ·ä¿¡æ¯

```mermaid
flowchart TD
A[ç™»å½•å¤±è´¥] --> B{è´¦æˆ·æ˜¯å¦è¢«é”å®š?}
B --> |æ˜¯| C[æ˜¾ç¤ºé”å®šä¿¡æ¯]
B --> |å¦| D[æ˜¾ç¤ºé€šç”¨é”™è¯¯]
C --> E["è´¦æˆ·å·²è¢«é”å®šï¼Œè¯·åœ¨Xåˆ†é’Ÿåé‡è¯•"]
D --> F["ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"]
```

**Diagram sources**
- [auth.py](file://src/auth.py#L416-L434)

**Section sources**
- [auth.py](file://src/auth.py#L416-L434)

## æµ‹è¯•éªŒè¯æœºåˆ¶

### æµ‹è¯•ç”¨ä¾‹è®¾è®¡
`test_auth.py`æ–‡ä»¶ä¸­å®ç°äº†å¯¹è´¦æˆ·é”å®šæœºåˆ¶çš„å®Œæ•´æµ‹è¯•éªŒè¯ã€‚

```mermaid
sequenceDiagram
participant æµ‹è¯•è„šæœ¬
participant auth.py
participant æ•°æ®åº“
æµ‹è¯•è„šæœ¬->>æµ‹è¯•è„šæœ¬ : åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
æµ‹è¯•è„šæœ¬->>æ•°æ®åº“ : åˆ é™¤æ—§æ•°æ®åº“
æµ‹è¯•è„šæœ¬->>auth.py : åˆå§‹åŒ–æ•°æ®åº“
æµ‹è¯•è„šæœ¬->>auth.py : è¿ç»­5æ¬¡é”™è¯¯ç™»å½•
auth.py-->>æµ‹è¯•è„šæœ¬ : ç¬¬5æ¬¡åè´¦æˆ·é”å®š
æµ‹è¯•è„šæœ¬->>auth.py : ç¬¬6æ¬¡ç™»å½•å°è¯•
auth.py-->>æµ‹è¯•è„šæœ¬ : éªŒè¯è¿”å›å¤±è´¥
```

**Diagram sources**
- [test_auth.py](file://test/test_auth.py#L0-L188)

### æµ‹è¯•æµç¨‹è¯´æ˜
æµ‹è¯•è„šæœ¬é€šè¿‡æ¨¡æ‹Ÿè¿ç»­å¤±è´¥ç™»å½•æ¥éªŒè¯é”å®šæœºåˆ¶ï¼š

1. æ¸…é™¤æ—§çš„æµ‹è¯•æ•°æ®åº“
2. åˆå§‹åŒ–è®¤è¯æ•°æ®åº“
3. æ‰§è¡Œ5æ¬¡é”™è¯¯å¯†ç ç™»å½•å°è¯•
4. éªŒè¯ç¬¬6æ¬¡ç™»å½•è¢«æ­£ç¡®æ‹’ç»
5. æ£€æŸ¥æ•°æ®åº“ä¸­çš„failed_login_attemptså’Œlocked_untilå­—æ®µ

**Section sources**
- [test_auth.py](file://test/test_auth.py#L0-L47)

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é”å®šçŠ¶æ€æœªæ­£ç¡®æ¸…é™¤
**é—®é¢˜æè¿°**ï¼šç”¨æˆ·åœ¨é”å®šæ—¶é—´è¿‡åä»æ— æ³•ç™»å½•  
**æ ¹æœ¬åŸå› **ï¼š`is_user_locked`å‡½æ•°ä¸­æœªæ­£ç¡®å¤„ç†è¿‡æœŸé”å®šçŠ¶æ€çš„æ¸…é™¤  
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿`clear_user_lock`å‡½æ•°è¢«æ­£ç¡®è°ƒç”¨

```mermaid
flowchart TD
A[æ£€æŸ¥é”å®šçŠ¶æ€] --> B{locked_untilå­˜åœ¨?}
B --> |æ˜¯| C[è§£ææ—¶é—´]
C --> D{å½“å‰æ—¶é—´ < é”å®šæ—¶é—´?}
D --> |æ˜¯| E[è¿”å›é”å®šçŠ¶æ€]
D --> |å¦| F[è°ƒç”¨clear_user_lock]
F --> G[æ¸…é™¤é”å®šçŠ¶æ€]
G --> H[è¿”å›æœªé”å®š]
```

**Section sources**
- [auth.py](file://src/auth.py#L148-L154)

### æ—¶åŒºå¯¼è‡´çš„é”å®šæ—¶é—´å¼‚å¸¸
**é—®é¢˜æè¿°**ï¼šåœ¨ä¸åŒæ—¶åŒºç¯å¢ƒä¸‹é”å®šæ—¶é—´è®¡ç®—å‡ºç°åå·®  
**æ ¹æœ¬åŸå› **ï¼šä½¿ç”¨æœ¬åœ°æ—¶é—´è€ŒéUTCæ—¶é—´è¿›è¡Œæ¯”è¾ƒ  
**è§£å†³æ–¹æ¡ˆ**ï¼šç»Ÿä¸€ä½¿ç”¨UTCæ—¶é—´å­˜å‚¨å’Œæ¯”è¾ƒé”å®šæ—¶é—´

## æ‰©å±•æ–¹æ¡ˆå»ºè®®

### å¯†ç ç­–ç•¥åŠ¨æ€é…ç½®
ä¸ºæ”¯æŒå¯†ç ç­–ç•¥çš„åŠ¨æ€é…ç½®ï¼Œå»ºè®®å®ç°é…ç½®ç®¡ç†æ¨¡å—ï¼š

```mermaid
classDiagram
class SecurityConfig {
-int min_password_length
-bool require_uppercase
-bool require_lowercase
-bool require_digits
-bool require_special_chars
-int max_login_attempts
-int lockout_duration
+load_config() void
+save_config() void
+get_config() dict
}
class AuthSystem {
+authenticate_user() bool
+validate_password() bool
}
SecurityConfig --> AuthSystem : "æä¾›é…ç½®"
```

**Section sources**
- [auth.py](file://src/auth.py#L38-L44)

### å…¥ä¾µæ£€æµ‹æ‰©å±•
å»ºè®®å¢åŠ åŸºäºè¡Œä¸ºåˆ†æçš„å…¥ä¾µæ£€æµ‹åŠŸèƒ½ï¼š

```mermaid
flowchart TD
A[ç™»å½•å°è¯•] --> B{å¤±è´¥æ¬¡æ•°å¼‚å¸¸?}
B --> |æ˜¯| C[è®°å½•IPåœ°å€]
C --> D{åŒä¸€IPå¤šæ¬¡å¤±è´¥?}
D --> |æ˜¯| E[ä¸´æ—¶IPå°é”]
E --> F[å‘é€å®‰å…¨è­¦æŠ¥]
B --> |å¦| G[æ­£å¸¸å¤„ç†]
D --> |å¦| G
```