# ç‚¹äº‘å¯è§†åŒ–

<cite>
**Referenced Files in This Document**   
- [main.py](file://src/main.py)
- [requirements.txt](file://config/requirements.txt)
- [test_pointcloud_unit.py](file://test/test_pointcloud_unit.py)
</cite>

## ç›®å½•
1. [å•æ–‡ä»¶ç‚¹äº‘å¯è§†åŒ–](#å•æ–‡ä»¶ç‚¹äº‘å¯è§†åŒ–)
2. [å¤šæ–‡ä»¶ç‚¹äº‘å¯¹æ¯”å¯è§†åŒ–](#å¤šæ–‡ä»¶ç‚¹äº‘å¯¹æ¯”å¯è§†åŒ–)
3. [ç‚¹äº‘æ•°æ®åŠ è½½æœºåˆ¶](#ç‚¹äº‘æ•°æ®åŠ è½½æœºåˆ¶)
4. [Plotly 3Då›¾è¡¨é…ç½®](#plotly-3då›¾è¡¨é…ç½®)
5. [æ€§èƒ½ä¼˜åŒ–ä¸å¼‚å¸¸å¤„ç†](#æ€§èƒ½ä¼˜åŒ–ä¸å¼‚å¸¸å¤„ç†)

## å•æ–‡ä»¶ç‚¹äº‘å¯è§†åŒ–

è¯¥åŠŸèƒ½é€šè¿‡ `visualize_single_pointcloud` å‡½æ•°å®ç°ï¼Œæä¾›äº¤äº’å¼å‚æ•°æ§åˆ¶ï¼Œæ”¯æŒå¯¹å•ä¸ªç‚¹äº‘æ–‡ä»¶è¿›è¡Œè¯¦ç»†å¯è§†åŒ–ã€‚

**Section sources**
- [main.py](file://src/main.py#L73-L197)

### é‡‡æ ·ç­–ç•¥

ç³»ç»Ÿé‡‡ç”¨éšæœºé‡‡æ ·ç­–ç•¥æ¥å¤„ç†å¤§è§„æ¨¡ç‚¹äº‘æ•°æ®ã€‚å½“ç‚¹äº‘çš„åŸå§‹ç‚¹æ•°è¶…è¿‡ç”¨æˆ·è®¾å®šçš„â€œæœ€å¤§æ˜¾ç¤ºç‚¹æ•°â€æ—¶ï¼Œç³»ç»Ÿä¼šä½¿ç”¨ `np.random.choice` ä»åŸå§‹ç‚¹äº‘ä¸­éšæœºæŠ½å–æŒ‡å®šæ•°é‡çš„ç‚¹è¿›è¡Œæ˜¾ç¤ºï¼Œç¡®ä¿å¯è§†åŒ–æ€§èƒ½ã€‚

```mermaid
flowchart TD
Start([å¼€å§‹å¯è§†åŒ–]) --> Load["åŠ è½½ç‚¹äº‘æ•°æ®"]
Load --> CheckSize{"åŸå§‹ç‚¹æ•° > æœ€å¤§æ˜¾ç¤ºç‚¹æ•°?"}
CheckSize --> |æ˜¯| Sample["éšæœºé‡‡æ ·"]
CheckSize --> |å¦| UseAll["ä½¿ç”¨å…¨éƒ¨ç‚¹"]
Sample --> Display
UseAll --> Display
Display["æ˜¾ç¤ºé‡‡æ ·åçš„ç‚¹äº‘"] --> End([ç»“æŸ])
```

**Diagram sources**
- [main.py](file://src/main.py#L106-L115)

### é¢œè‰²æ˜ å°„æ–¹å¼

ç³»ç»Ÿæä¾›ä¸‰ç§é¢œè‰²æ˜ å°„æ¨¡å¼ï¼š
- **é«˜åº¦ (Z)**ï¼šæ ¹æ®ç‚¹çš„Zåæ ‡å€¼è¿›è¡Œé¢œè‰²æ˜ å°„ï¼Œä½¿ç”¨Viridisè‰²è°±
- **åŸå§‹é¢œè‰²**ï¼šæ˜¾ç¤ºç‚¹äº‘æ–‡ä»¶ä¸­è‡ªå¸¦çš„é¢œè‰²ä¿¡æ¯
- **å‡åŒ€é¢œè‰²**ï¼šæ‰€æœ‰ç‚¹æ˜¾ç¤ºä¸ºç»Ÿä¸€çš„è“è‰²

```mermaid
classDiagram
class ColorMode
ColorMode : +HEIGHT_Z
ColorMode : +ORIGINAL_COLOR
ColorMode : +UNIFORM_COLOR
ColorMode : +apply_color_mapping(sampled_points, sampled_colors, mode)
```

**Diagram sources**
- [main.py](file://src/main.py#L106-L148)

### äº¤äº’å¼å‚æ•°æ§åˆ¶

ç”¨æˆ·å¯é€šè¿‡ä»¥ä¸‹äº¤äº’å¼æ§ä»¶è°ƒæ•´å¯è§†åŒ–æ•ˆæœï¼š
- **æœ€å¤§æ˜¾ç¤ºç‚¹æ•°**ï¼šæ»‘å—æ§ä»¶ï¼ŒèŒƒå›´1000è‡³100000ï¼Œç”¨äºæ§åˆ¶æ€§èƒ½
- **ç‚¹å¤§å°**ï¼šæ»‘å—æ§ä»¶ï¼ŒèŒƒå›´1è‡³10ï¼Œè°ƒæ•´ç‚¹çš„è§†è§‰å¤§å°
- **é¢œè‰²æ¨¡å¼**ï¼šä¸‹æ‹‰é€‰æ‹©æ¡†ï¼Œé€‰æ‹©ä¸‰ç§é¢œè‰²æ˜ å°„æ–¹å¼
- **è§†è§’æ¨¡å¼**ï¼šä¸‹æ‹‰é€‰æ‹©æ¡†ï¼Œé€‰æ‹©3Dã€XYã€XZæˆ–YZè§†è§’

**Section sources**
- [main.py](file://src/main.py#L84-L106)

## å¤šæ–‡ä»¶ç‚¹äº‘å¯¹æ¯”å¯è§†åŒ–

`visualize_multiple_pointclouds` å‡½æ•°æä¾›ä¸‰ç§æ¨¡å¼çš„å¤šæ–‡ä»¶å¯¹æ¯”å¯è§†åŒ–åŠŸèƒ½ã€‚

**Section sources**
- [main.py](file://src/main.py#L199-L380)

### å¹¶æ’æ˜¾ç¤ºæ¨¡å¼

è¯¥æ¨¡å¼å°†é€‰ä¸­çš„å¤šä¸ªç‚¹äº‘æ–‡ä»¶åœ¨å¹¶æ’çš„å­å›¾ä¸­åˆ†åˆ«æ˜¾ç¤ºï¼Œä¾¿äºç›´è§‚æ¯”è¾ƒä¸åŒç‚¹äº‘çš„ç»“æ„ç‰¹å¾ã€‚

```mermaid
flowchart TB
subgraph "å¹¶æ’æ˜¾ç¤º"
A["ç‚¹äº‘æ–‡ä»¶A"] --> FigA["åˆ›å»ºç‹¬ç«‹å›¾è¡¨"]
B["ç‚¹äº‘æ–‡ä»¶B"] --> FigB["åˆ›å»ºç‹¬ç«‹å›¾è¡¨"]
FigA --> Col1["æ”¾ç½®åœ¨ç¬¬ä¸€åˆ—"]
FigB --> Col2["æ”¾ç½®åœ¨ç¬¬äºŒåˆ—"]
end
```

**Diagram sources**
- [main.py](file://src/main.py#L199-L231)

### å‰ç«¯æ˜¾ç¤ºé™åˆ¶
- æ¯æ¬¡æœ€å¤šæ˜¾ç¤ºä¸¤ä¸ªæ–‡ä»¶ï¼ˆä¸¤åˆ—å¸ƒå±€ï¼‰
- æ¯ä¸ªæ–‡ä»¶æœ€å¤§æ˜¾ç¤ºç‚¹æ•°é™åˆ¶ä¸º5000ï¼Œä»¥ä¿è¯æ€§èƒ½
- ä½¿ç”¨è¾ƒå°çš„ç‚¹å¤§å°ï¼ˆsize=2ï¼‰å’Œè¾ƒä½çš„é€æ˜åº¦ï¼ˆopacity=0.7ï¼‰

### å‰ç«¯å åŠ æ˜¾ç¤ºæ¨¡å¼

è¯¥æ¨¡å¼å°†å¤šä¸ªç‚¹äº‘å åŠ åœ¨åŒä¸€3Dç©ºé—´ä¸­æ˜¾ç¤ºï¼Œä½¿ç”¨ä¸åŒçš„é¢œè‰²åŒºåˆ†å„ä¸ªæ–‡ä»¶ã€‚

```mermaid
flowchart TD
Start --> Init["åˆå§‹åŒ–ç©ºå›¾è¡¨"]
Init --> Loop["éå†æ¯ä¸ªé€‰ä¸­æ–‡ä»¶"]
Loop --> Load["åŠ è½½ç‚¹äº‘æ•°æ®"]
Load --> Sample["éšæœºé‡‡æ ·"]
Sample --> Color["åˆ†é…é¢œè‰²"]
Color --> Add["æ·»åŠ åˆ°åŒä¸€å›¾è¡¨"]
Add --> NextFile
NextFile --> Loop
Loop --> |å®Œæˆ| UpdateLayout["æ›´æ–°å›¾è¡¨å¸ƒå±€"]
UpdateLayout --> Display["æ˜¾ç¤ºå åŠ ç»“æœ"]
```

**Diagram sources**
- [main.py](file://src/main.py#L258-L290)

### å‰ç«¯ç»Ÿè®¡å¯¹æ¯”åˆ†ææ¨¡å¼

è¯¥æ¨¡å¼ä¸è¿›è¡Œ3Då¯è§†åŒ–ï¼Œè€Œæ˜¯æå–å„ç‚¹äº‘æ–‡ä»¶çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä»¥è¡¨æ ¼å’ŒæŸ±çŠ¶å›¾å½¢å¼è¿›è¡Œå¯¹æ¯”åˆ†æã€‚

```mermaid
erDiagram
POINT_CLOUD_STATS {
string æ–‡ä»¶å PK
int ç‚¹æ•°é‡
string XèŒƒå›´
string YèŒƒå›´
string ZèŒƒå›´
float Xå¹³å‡
float Yå¹³å‡
float Zå¹³å‡
float æ–‡ä»¶å¤§å°MB
string æœ‰æ— é¢œè‰²
}
```

**Diagram sources**
- [main.py](file://src/main.py#L318-L349)

## ç‚¹äº‘æ•°æ®åŠ è½½æœºåˆ¶

`load_point_cloud` å‡½æ•°è´Ÿè´£æ”¯æŒå¤šç§ç‚¹äº‘æ ¼å¼çš„åŠ è½½ï¼Œå¹¶å¤„ç†å¤–éƒ¨ä¾èµ–ã€‚

**Section sources**
- [main.py](file://src/main.py#L29-L71)

### æ ¼å¼æ”¯æŒæœºåˆ¶

| æ ¼å¼ | æ”¯æŒçŠ¶æ€ | ä¾èµ–åº“ | é¢œè‰²æ”¯æŒ |
|------|---------|--------|---------|
| PCD | âœ… | Open3D | âœ… |
| LAS/LAZ | âœ… | laspy | âœ… |
| TXT/XYZ | âœ… | NumPy | âœ… (ç¬¬4-6åˆ—) |

```mermaid
flowchart LR
File --> Extension{"æ–‡ä»¶æ‰©å±•å?"}
Extension --> |PCD| Open3D{Open3Då¯ç”¨?}
Extension --> |LAS/LAZ| Laspy{laspyå¯ç”¨?}
Extension --> |TXT/XYZ| NumPy["ä½¿ç”¨np.loadtxt"]
Open3D --> |æ˜¯| ReadPCD["o3d.io.read_point_cloud"]
Open3D --> |å¦| Error1["æ˜¾ç¤ºå®‰è£…æç¤º"]
Laspy --> |æ˜¯| ReadLAS["laspy.read"]
Laspy --> |å¦| Error2["æ˜¾ç¤ºå®‰è£…æç¤º"]
```

**Diagram sources**
- [main.py](file://src/main.py#L29-L71)
- [requirements.txt](file://config/requirements.txt)

### ä¾èµ–å¤„ç†

ç³»ç»Ÿé€šè¿‡try-exceptå—åŠ¨æ€æ£€æµ‹Open3Då’Œlaspyåº“çš„å¯ç”¨æ€§ï¼Œå¹¶åœ¨åº“æœªå®‰è£…æ—¶æä¾›å‹å¥½çš„é”™è¯¯æç¤ºï¼Œè€Œéç¨‹åºå´©æºƒã€‚

```python
try:
    import open3d as o3d
    OPEN3D_AVAILABLE = True
except ImportError:
    OPEN3D_AVAILABLE = False
    st.warning("âš ï¸ Open3Dåº“æœªå®‰è£…ï¼Œç‚¹äº‘å¯è§†åŒ–åŠŸèƒ½å°†å—é™ã€‚è¯·è¿è¡Œ: pip install open3d")
```

**Section sources**
- [main.py](file://src/main.py#L10-L27)

## Plotly 3Då›¾è¡¨é…ç½®

ç³»ç»Ÿä½¿ç”¨Plotlyåº“åˆ›å»ºé«˜è´¨é‡çš„3Dç‚¹äº‘å¯è§†åŒ–å›¾è¡¨ã€‚

**Section sources**
- [main.py](file://src/main.py#L144-L185)

### ç›¸æœºè§†è§’é…ç½®

| è§†è§’æ¨¡å¼ | ç›¸æœºä½ç½® (x,y,z) | ç”¨é€” |
|--------|----------------|------|
| 3Dè§†è§’ | (1.5, 1.5, 1.5) | å…¨é¢è§‚å¯Ÿ |
| ä»ä¸Šå‘ä¸‹ (XY) | (0, 0, 3) | å¹³é¢åˆ†å¸ƒåˆ†æ |
| ä»å‰å‘å (XZ) | (0, 3, 0) | ä¾§é¢è½®å»“åˆ†æ |
| ä»å·¦å‘å³ (YZ) | (3, 0, 0) | ä¾§é¢è½®å»“åˆ†æ |

```mermaid
graph TD
A[ç›¸æœºè®¾ç½®] --> B["3Dè§†è§’: eye=dict(x=1.5, y=1.5, z=1.5)"]
A --> C["XYè§†è§’: eye=dict(x=0, y=0, z=3)"]
A --> D["XZè§†è§’: eye=dict(x=0, y=3, z=0)"]
A --> E["YZè§†è§’: eye=dict(x=3, y=0, z=0)"]
```

**Diagram sources**
- [main.py](file://src/main.py#L144-L185)

### æ ‡è®°æ ·å¼ä¸å¸ƒå±€

- **æ ‡è®°å¤§å°**ï¼šç”±ç”¨æˆ·é€šè¿‡æ»‘å—æ§åˆ¶ï¼ˆ1-10ï¼‰
- **é€æ˜åº¦**ï¼šå›ºå®šä¸º0.8ï¼Œç¡®ä¿ç‚¹äº‘å†…éƒ¨ç»“æ„å¯è§
- **å¸ƒå±€é«˜åº¦**ï¼š600åƒç´ ï¼Œç¡®ä¿è¶³å¤Ÿæ˜¾ç¤ºç©ºé—´
- **è¾¹è·**ï¼šå››è¾¹è·è®¾ä¸º0ï¼Œæœ€å¤§åŒ–åˆ©ç”¨å®¹å™¨ç©ºé—´
- **é•¿å®½æ¯”**ï¼šè®¾ç½®ä¸º'cube'ï¼Œä¿æŒåæ ‡è½´æ¯”ä¾‹ä¸€è‡´

**Section sources**
- [main.py](file://src/main.py#L144-L185)

## æ€§èƒ½ä¼˜åŒ–ä¸å¼‚å¸¸å¤„ç†

ç³»ç»Ÿå®ç°äº†å¤šç§æœºåˆ¶æ¥å¤„ç†å¤§æ•°æ®é›†å’Œå¼‚å¸¸æƒ…å†µã€‚

### å¤§æ–‡ä»¶åŠ è½½ä¼˜åŒ–

å¯¹äºå¤§æ–‡ä»¶åŠ è½½ç¼“æ…¢çš„æƒ…å†µï¼Œç³»ç»Ÿé‡‡ç”¨éšæœºé‡‡æ ·ç­–ç•¥ï¼š

```mermaid
flowchart TD
Load --> CheckSize{"ç‚¹æ•° > 10000?"}
CheckSize --> |æ˜¯| RandomSample["np.random.choice(ç‚¹, 10000)"]
CheckSize --> |å¦| DirectUse["ç›´æ¥ä½¿ç”¨"]
RandomSample --> Visualize
DirectUse --> Visualize
```

**Diagram sources**
- [test_pointcloud_unit.py](file://test/test_pointcloud_unit.py#L155-L170)

### Open3Dæœªå®‰è£…é™çº§å¤„ç†

å½“Open3Dåº“æœªå®‰è£…æ—¶ï¼Œç³»ç»Ÿä¸ä¼šå´©æºƒï¼Œè€Œæ˜¯æ˜¾ç¤ºå‹å¥½æç¤ºï¼š

```python
if OPEN3D_AVAILABLE:
    # æ­£å¸¸åŠ è½½PCDæ–‡ä»¶
else:
    st.error("ğŸš« éœ€è¦å®‰è£… Open3D åº“æ¥è¯»å– PCD æ–‡ä»¶")
    return None, None
```

**Section sources**
- [main.py](file://src/main.py#L30-L34)

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç‚¹æ•°é™åˆ¶**ï¼šå»ºè®®æœ€å¤§æ˜¾ç¤ºç‚¹æ•°ä¸è¶…è¿‡100,000
2. **é‡‡æ ·ç®—æ³•**ï¼šä½¿ç”¨éšæœºé‡‡æ ·è€Œéå‡åŒ€é‡‡æ ·ï¼Œä¿æŒç‚¹äº‘ç‰¹å¾
3. **å¹¶æ’æ˜¾ç¤º**ï¼šé™åˆ¶æ¯æ–‡ä»¶5000ç‚¹ï¼Œç¡®ä¿æµç•…æ€§
4. **å åŠ æ˜¾ç¤º**ï¼šé™åˆ¶æ¯æ–‡ä»¶2000ç‚¹ï¼Œé¿å…è§†è§‰æ··ä¹±
5. **æ‚¬åœä¿¡æ¯**ï¼šä»…å¯¹å‰100ä¸ªç‚¹æ·»åŠ æ‚¬åœä¿¡æ¯ï¼Œæå‡æ€§èƒ½